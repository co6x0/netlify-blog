---
templateKey: blog-post
title: ãƒ‘ãƒ©ãƒ©ãƒƒã‚¯ã‚¹-2 | ãƒ”ãƒ¥ã‚¢ãªJavaScriptã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‰ã§å®Ÿè£…ã—ãŸã„ Part2
date: 2019-12-21T17:25:09.427Z
category:
  - Development
tags:
  - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
  - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  - JavaScript
  - ãƒ‘ãƒ©ãƒ©ãƒƒã‚¯ã‚¹
pickup: false
---
å‰å›ã®ç¶šãã§ã™ã€‚çã—ãæ›´æ–°ãŒæ—©ã„ã€‚

[ãƒ”ãƒ¥ã‚¢ãªJavaScriptã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªå‰ã§å®Ÿè£…ã—ãŸã„ - Part1. ãƒ‘ãƒ©ãƒ©ãƒƒã‚¯ã‚¹](https://sixaxd.com/blog/201912164853/)

å‰å›ã¯å‹•ã‹ã—ãŸã„å„è¦ç´ ã®windowå†…ã«ãŠã‘ã‚‹è¡¨ç¤ºç‡ã®Ratioã‚’æ±‚ã‚ã¾ã—ãŸã€‚

å®Ÿã¯è¡¨ç¤ºç‡ã ã‘ã§è¨€ã†ã¨ã€Intersection Observer APIã®intersectionRatioãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰å–å¾—ã§ãã‚‹ã®ã§ã™ãŒã€ç”»é¢å†…ã«è¦ç´ ãŒå…¥ã£ã¦ã„ã‚‹ã¨ãã«Intersection Observerã‚’ã‚¤ãƒ™ãƒ³ãƒˆã«åˆ©ç”¨ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹ã®ãŒå°‘ã—é¢å€’ã ã£ãŸæ°—ãŒã—ã¾ã™ã€‚

ä»¥å‰ã€Intersection Observerã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ“¬ä¼¼çš„ã«å†ç¾ã—ã¦ã¿ãŸã®ã§ã™ãŒã€ãªã‚“ã‚‰ã‹ã®ç†ç”±ã§ä½¿ç”¨ã‚’è¦‹é€ã£ãŸã®ã§ã™ã‚ˆã­ã€‚ã—ã‹ã—ã€ãã®ç†ç”±ã‚’å¿˜ã‚Œã¦ã—ã¾ã£ãŸã€‚

ãŸã ã€ã©ã£ã¡ã§ã‚‚ã§ãã‚‹ã¨æ€ã†ã®ã§å¥½ããªæ–¹ã‚’ä½¿ã£ã¦è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

ğŸ‘‡ã“ã‚Œã®é€”ä¸­ã§å‡ºã¦ãã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã¨ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ãŒ1~100ã¾ã§å¤‰åŒ–ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ãŒå‚è€ƒã«ãªã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚

[Intersection Observer API](https://developer.mozilla.org/ja/docs/Web/API/Intersection_Observer_API)

# Ratioã‚’åˆ©ç”¨ã—ã¦è¦ç´ ã‚’å‹•ã‹ã™

å‰å›æº–å‚™ã—ãŸGSAPã®è¨­å®šã‚’ã—ã¾ã™ã€‚

GSAPã«ã¤ã„ã¦ã¯è©³ã—ãèª¬æ˜ã—ãªã„ã®ã§ã€ã‚ˆãåˆ†ã‹ã‚‰ãªã„ã¨ã“ã‚ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã§ã„ãŸã ã‘ã‚Œã°ã¨ã€‚

[Docs - GreenSock](https://greensock.com/docs/v3)

`gsap.defaults`ã§æ¯å›æ›¸ã‹ãªã„ã¨ã„ã‘ãªã„ã€åŒã˜ã‚ˆã†ãªè¨­å®šã‚’çœç•¥ã§ãã¾ã™ã€‚

ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«é€£å‹•ã—ã¦å‹•ãã®ã§durationãŒå¤§ãã™ãã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ã„ã†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒé…ã‚Œã‚‹ã®ã§å°ã•ã‚ã«ã€‚easeã‚‚ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ€§ã‚’è¿½æ±‚ã™ã‚‹ã®ã§ã‚ã‚Œã°ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®å‹•ãã«é€£å‹•ã™ã‚‹ã¹ããªã®ã§none(Linear)ã«ã—ã¾ã™ã€‚

```javascript
gsap.defaults({
  duration: 0.1,
  ease: 'none'
})
```

ã¤ãã«ã€å‹•ã‹ã™è¦ç´ ã®ä½ç½®ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã£ã¦ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹é–¢æ•°ã‚’ç”¨æ„ã—ã¾ã™ã€‚

å¼•æ•°ã«ã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¨ãªã‚‹è¦ç´ ã¨ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ç”»é¢è¡¨ç¤ºç‡ã‚’è¨­å®šã€‚

ratioã¯ä¸Šã‹ã‚‰ä¸‹ã«è¡Œãã«ã¤ã‚Œã¦1â†’0ã«å‘ã‹ã£ã¦ã„ãã®ã§ã€yæ–¹å‘ã®distanceã‚’ç›®æ¨™ã¨ã—ã€ç”»é¢ã‹ã‚‰è¦ç´ ãŒæ¶ˆãˆã‚‹é ƒã«distanceåˆ†ã ã‘ç§»å‹•ã—ã¦ã„ã‚‹ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§å‹•ã‹ã—ã¾ã™ã€‚

```javascript
function updatePosition(target, ratio, distance) {
    gsap.to(target, {
      y: distance - distance * ratio
    })
  }
```

ã“ã“ã¾ã§æ¥ãŸã‚‰ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ã§`updatePosition(targetImage, ratio.image, 120)`ã¨ã‹ã™ã‚‹ã¨å‹•ãã‹ã¨æ€ã„ã¾ã™ã€‚

# ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ€é©åŒ–ã™ã‚‹

ã‚·ãƒ³ãƒ—ãƒ«ã«yæ–¹å‘ã«ç§»å‹•ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¾ã—ãŸãŒã€Ratioã‚’åˆ©ç”¨ã—ã¦ä»–ã«ã‚‚è‰²ã€…ãªã“ã¨ãŒå‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚ä»Šå›ã¯ãã¡ã‚‰å´ã¯ã‚„ã‚Šã¾ã›ã‚“ã®ã§ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ€é©åŒ–ã‚’ã—ã¦çµ‚ã‚ã‚Šã«ã—ã¾ã™ã€‚

## preventDefault()ã‚’å®Ÿè¡Œã—ãªã„ã“ã¨ã‚’æ˜ç¤ºã™ã‚‹

ã¾ãšã¯ä¸€ç•ªç°¡å˜ã«ã§ãã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã®æœ€é©åŒ–ã€‚

addEventListnerã®ç¬¬3å¼•æ•°ã§ã‚ã‚‹optionsã®passiveã‚’trueã«ã™ã‚‹ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«å¯¾ã—æŒ‡å®šé–¢æ•°å†…ã§`preventDefault()` ã‚’å‘¼ã³å‡ºã—ã¦ã„ãªã„ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚

æ­£ç›´ãªæ‰€ã€åƒ•ã‚‚è©³ã—ãã¯ç†è§£ã§ãã¦ã„ãªã„ã®ã§ã™ãŒã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†ãŒçµ‚ã‚ã‚‹ã¾ã§`preventDefault()`ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ãƒ–ãƒ©ã‚¦ã‚¶å´ã§ã¯åˆ¤æ–­ãŒã§ããšã€ãã®é–“ã¯ãƒšãƒ¼ã‚¸ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚ãã‚ŒãŒåŸå› ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæ‚ªããªã‚‹ã‚ˆã†ï¼Ÿ

[EventTarget.addEventListener()](https://developer.mozilla.org/ja/docs/Web/API/EventTarget/addEventListener)

## throttleã§ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«å›æ•°ã‚’é–“å¼•ã

ã¤ã¥ã„ã¦ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«å›æ•°ã‚’é–“å¼•ãã¾ã™ã€‚

ã“ã“ã§ã¯ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ï¼ˆè‡ªå‰å®Ÿè£…ã¨ã¯ï¼‰

[niksy/throttle-debounce](https://github.com/niksy/throttle-debounce)

ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã®ä¸­ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã‚’throttleã§å›²ã¿ã€ã‚¤ãƒ™ãƒ³ãƒˆå†…éƒ¨ã®å®Ÿè¡Œé–“éš”ã‚’60fpsã«ãªã‚‹ã‚ˆã†ã«16msã”ã¨ã«é–“å¼•ãã¾ã™ã€‚

```javascript
window.addEventListener('scroll', throttle(16, () => {
    const scrollAmount = window.pageYOffset
    const ratio = {
      image: calculateRatio(image.top, image.bottom, scrollAmount),
      title: calculateRatio(title.top, title.bottom, scrollAmount),
      caption: calculateRatio(caption.top, caption.bottom, scrollAmount),
    }
    updatePosition(targetImage, ratio.image, 200)
    updatePosition(targetTitle, ratio.title, -320)
    updatePosition(targetCaption, ratio.caption, 40)
  }), {passive: true})
```

## requestAnimationFrameã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’å¾…ãŸã›ã‚‹

ã•ã‚‰ã«ã€`requestAnimationFrame()`ã‚’ä½¿ç”¨ã—ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®æº–å‚™ãŒæ•´ã£ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã€‚

throttleã¯ä½¿ç”¨ã›ãšã«ã“ã¡ã‚‰ã ã‘ã§ã‚‚è‰¯ã„ã‚ˆã†ãªæ°—ãŒã—ã¾ã™ãŒã€60Hzä»¥ä¸Šã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ¬ãƒ¼ãƒˆã‚’æŒã¤ãƒ¢ãƒ‹ã‚¿ãƒ¼ã®å ´åˆã€ã“ã¡ã‚‰ãŒæƒ³å®šã—ã¦ã„ã‚‹ä»¥ä¸Šã«å‡¦ç†ãŒèµ°ã£ã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§throttleã‚‚ã‚ã£ãŸã»ã†ãŒä¸‡å…¨ã‹ã‚‚ï¼Ÿ

ã‚ˆã‚Šæ»‘ã‚‰ã‹ãªãªã»ã†ãŒè‰¯ã„ï¼ã¨ã„ã†å ´åˆã¯throttleã¯ä½¿ã‚ãªãã¦è‰¯ã„æ°—ãŒã—ã¾ã™ã€‚

```javascript
let isRafActive = false
  
  window.addEventListener('scroll', throttle(16, () => {
    const scrollAmount = window.pageYOffset
    const ratio = {
      image: calculateRatio(image.top, image.bottom, scrollAmount),
      title: calculateRatio(title.top, title.bottom, scrollAmount),
      caption: calculateRatio(caption.top, caption.bottom, scrollAmount),
    }
    if (!isRafActive) {
      isRafActive = true
      requestAnimationFrame(() => {
        updatePosition(targetImage, ratio.image, 200)
        updatePosition(targetTitle, ratio.title, -320)
        updatePosition(targetCaption, ratio.caption, 40)
        isRafActive = false
      })
    }
  }), {passive: true})
```

## ãã®ä»–ã®æœ€é©åŒ–

ç¾æ®µéšã§ã¯å‹•ã‹ã™è¦ç´ ãŒè¡¨ç¤ºé ˜åŸŸå¤–ã«ã‚ã£ã¦ã‚‚DOMã®Styleã«æ›´æ–°ãŒã‹ã‹ã£ã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚ã“ã‚Œã¯ç„¡é§„ãªå‡¦ç†ãªã®ã§ã€RatioãŒ0~1ä»¥å†…ã®ã¨ãã ã‘è¦ç´ ã‚’å‹•ã‹ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

```javascript
function updatePosition(target, ratio, distance) {
    if (0 < ratio && ratio < 1) {
      gsap.to(target, {
        y: distance - distance * ratio
      })
    }
  }
```

ã‚ã¨ã¯ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã®å†…ã®å‡¦ç†ã‚’ã‚‚ã£ã¨å°‘ãªãã™ã‚‹ãŸã‚ã«ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã§ã¯windowã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ã‚’æ›´æ–°ã™ã‚‹ã ã‘ã«ã—ã¦ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ã‚’ç®¡ç†ã™ã‚‹å¤‰æ•°ã‚’ç›£è¦–ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¨ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆå†…ã®å‡¦ç†ãŒå¢—ãˆã‚‹ã“ã¨ã®ã©ã¡ã‚‰ãŒæ—©ã„ã‹ã©ã†ã‹ã¯ã¾ã èª¿æŸ»ã—ã¦ã„ãªã„ã®ã§åˆ†ã‹ã‚Šã¾ã›ã‚“ãŒâ€¦â€¦ã€‚

# ã¾ã¨ã‚

ä»¥ä¸‹ã®é€šã‚Šã¡ã‚‡ã£ã¨ã ã‘ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã—ã¾ã—ãŸã€‚

* å‹•ã‹ã—ãŸã„è¦ç´ ã®å„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å®šç¾©ãŒå†—é•·ã ã£ãŸã®ã§ã€ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã—ã¦ç°¡æ½”ã«
* ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒšãƒ¼ã‚¸ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸçŠ¶æ…‹ã ã¨ã€ã‚¬ã‚¯ãƒƒã¨è¦ç´ ãŒå‹•ãå§‹ã‚ã¦ã—ã¾ã†ã®ã§ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã™ã‚‹ã‚ˆã†ã«ï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ãŒãªã„ã®ã§çµå±€loadã‚¤ãƒ™ãƒ³ãƒˆãŒèµ°ã£ãŸç¬é–“ã‚¬ã‚¯ãƒƒã¨å‹•ã„ã¦ã—ã¾ã†ï¼‰

```javascript
gsap.defaults({
  duration: 0.1,
  ease: 'none'
})

class TargetProps {
  constructor(target) {
    this.el = target
    this.y = target.offsetTop
    this.height = target.clientHeight
    this.top = this.y - window.innerHeight
    this.bottom = this.y + this.height
  }
}

window.addEventListener('load', () => {
  const image = new TargetProps(document.getElementById('targetImage'))
  const title = new TargetProps(document.getElementById('targetTitle'))
  const caption = new TargetProps(document.getElementById('targetCaption'))
  let scrollAmount = window.pageYOffset
  let isRafActive = false
  
  function calculateRatio(top, bottom, scroll) {
    const topAdjustNum = top * ((bottom - scroll) / bottom)
    return (bottom - scroll + topAdjustNum) / bottom
  }

  function updatePosition(target, ratio, distance) {
    if (0 < ratio && ratio < 1) {
      gsap.to(target, {
        y: distance - distance * ratio
      })
    }
  }

  const ratio = {
    image: calculateRatio(image.top, image.bottom, scrollAmount),
    title: calculateRatio(title.top, title.bottom, scrollAmount),
    caption: calculateRatio(caption.top, caption.bottom, scrollAmount),
  }

  // Set target position when page load
  updatePosition(image.el, ratio.image, 200)
  updatePosition(title.el, ratio.title, -320)
  updatePosition(caption.el, ratio.caption, 40)

  
  window.addEventListener('scroll', throttle(16, () => {
    scrollAmount = window.pageYOffset
    ratio.image = calculateRatio(image.top, image.bottom, scrollAmount)
    ratio.title = calculateRatio(title.top, title.bottom, scrollAmount)
    ratio.caption = calculateRatio(caption.top, caption.bottom, scrollAmount)

    if (!isRafActive) {
      isRafActive = true
      requestAnimationFrame(() => {
        updatePosition(image.el, ratio.image, 200)
        updatePosition(title.el, ratio.title, -320)
        updatePosition(caption.el, ratio.caption, 40)
        isRafActive = false
      })
    }
  }), {passive: true})
})
```

<iframe height="460" style="width: 100%;" scrolling="no" title="Basic Parallax Interaction" src="https://codepen.io/co6ei/embed/wvBzQPG?height=265&theme-id=default&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/co6ei/pen/wvBzQPG'>Basic Parallax Interaction</a> by nao
  (<a href='https://codepen.io/co6ei'>@co6ei</a>) on <a href='https://codepen.io'>CodePen</a>.
</iframe>

- - -

ãƒ‘ãƒ©ãƒ©ãƒƒã‚¯ã‚¹ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã—ãŸã€‚
